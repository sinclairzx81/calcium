/// <reference path="decl/node.d.ts" />

module calcium.web
{
    export class Response  
    {
        public headers : any;
        
        public body    : string;

        public error   : string;

        constructor()
        {
             
        }

        public static from_response(response:http.ClientResponse, callback:{(response:calcium.web.Response):void;}): void {
            
            var buffer = [];

            response.setEncoding('utf8');

            response.on('data', (chunk) =>
            {
                buffer.push(chunk.toString())
            });
            
            response.on('end', () =>{
            
                var result = new calcium.web.Response();

                result.headers = response.headers;

                result.body    = buffer.join('');
                
                callback(result);

            });

            response.on("error", (error) =>
            { 
                var result = new calcium.web.Response();

                result.headers = {}

                result.error   = error.toString();

                callback(result);
            });
          
        }
    }
}