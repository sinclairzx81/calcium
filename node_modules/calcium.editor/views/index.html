@{ this.layout = '/layout.html' } 

@section scripts() {

    <script type="text/javascript" src="/static/script/jquery/jquery-1.10.1.min.js"></script>
    
    <script type="text/javascript" src="/static/script/knockoutjs/knockout-2.2.1.js"></script>

    <script type="text/javascript" src="/static/script/ace/ace.js"></script>

    <script type="text/javascript" src="/static/script/linq/linq.min.js"></script>
    
    <script type="text/javascript" src="/static/script/calcium/calcium.api.js"></script>

    <script type="text/javascript" src="/static/script/calcium/calcium.models.js"></script>
    
    <style type="text/css">

        .icon-preloader {

            display             : inline-block;
            
            width               : 14px;
            
            height              : 14px;
            
            line-height         : 14px;
            
            vertical-align      : text-top;
            
            background-image    : url("/static/script/calcium/assets/preloader.gif");
            
            /*background-position : 14px 14px;
            
            background-repeat   : no-repeat;*/
           
            margin-top          : 1px;
         }


        .icon-space {
            
            display        : inline-block;
            
            width          : 14px;
            
            height         : 14px;
            
            line-height    : 14px;

            vertical-align : text-top;
            
            margin-top     : 1px;
        }

    /*#editor 
    { 
        margin: 0;
        position: relative;
        height : 1000px;
    }*/

    </style>
    
    <script type="text/javascript">
        
        var editor = null;

        var heightUpdateFunction = function() {

            // http://stackoverflow.com/questions/11584061/
            var newHeight =
                      editor.getSession().getScreenLength()
                      * editor.renderer.lineHeight
                      + editor.renderer.scrollBar.getWidth();

            $('#editor').height(newHeight.toString() + "px");
            $('#editor-section').height(newHeight.toString() + "px");

            // This call is required for the editor to fix all of
            // its inner structure for adapting to a change in size
            editor.resize();
        };

        function PageModel()
        {
            this.tree = ko.observable( new FolderModel(null, '/') );

            this.tree().load();

            this.tree().on('data', function(content) {
                
                editor.setValue(content, -1);

            });
        }

        function resize() {

            $('#editor').height($(window).height() - 120);    
            
            editor.resize();
        }

        function initialize() 
        {    
            ko.applyBindings( new PageModel() );

            editor = ace.edit("editor");
            
            editor.setPrintMarginColumn(false);

            //editor.setTheme("ace/theme/twilight");

            editor.getSession().setMode("ace/mode/typescript");

            $(window).resize(resize); resize();
        }
        
        $(document).ready( initialize );
        
    </script>
}

@section sidebar() {

     <script type="text/html" id="template.storage">
        
        <div data-bind="if: expanded">

            <a href="#" data-bind="click: toggle"><i class="icon-chevron-down"></i><i class="icon-hdd"></i><span data-bind="text:name"></span></a>

        </div>

        <div data-bind="ifnot: expanded">
            
            <a href="#" data-bind="click: toggle"><i class="icon-chevron-right"></i><i class="icon-hdd"></i><span data-bind="text:name"></span></a>     

        </div>  
               
        <div data-bind="if: expanded">

            <ul class="nav nav-list" data-bind="foreach: contents">
                
                <!-- ko if: type() == 'folder' -->

                    <li data-bind="template:{name:'template.folder', data:$data}" />
                
                <!-- /ko -->
                        
                <!-- ko if: type() == 'file' -->

                    <li data-bind="template:{name:'template.file', data:$data}" />

                <!-- /ko -->
            
            </ul>

        </div>

    </script>
   
    <script type="text/html" id="template.folder">

        <div data-bind="if: expanded">

            <a href="#" data-bind="click: toggle"><i class="icon-chevron-down"></i><i class="icon-folder-open"></i><span data-bind="text:name"></span></a>     

        </div>

        <div data-bind="ifnot: expanded">
            
            <a href="#" data-bind="click: toggle"><i class="icon-chevron-right"></i><i class="icon-folder-close"></i><span data-bind="text:name"></span></a>     

        </div>  
              
        <div data-bind="if: expanded">

            <ul class="nav nav-list" data-bind="foreach: contents">
                
                <!-- ko if: type() == 'folder' -->

                    <li data-bind="template:{name:'template.folder', data:$data}" />
                
                <!-- /ko -->
                        
                <!-- ko if: type() == 'file' -->

                    <li data-bind="template:{name:'template.file', data:$data}" />

                <!-- /ko -->
            
            </ul>

        </div>

    </script>   

    <script type="text/html" id="template.file">

        <div>

         <a href="#" data-bind="click: load"><i class="icon-space"></i><i class="icon-file"></i><span data-bind="text:name"></span></a>

       </div>

    </script>    
    

    
    <div class="well sidebar-nav">
        
        <ul class="nav nav-list" data-bind="foreach: tree().contents()">
            
            <!-- ko if: type() == 'storage' -->

                <li data-bind="template:{name:'template.storage', data:$data}" />
                
            <!-- /ko -->

            <!-- ko if: type() == 'folder' -->

                <li data-bind="template:{name:'template.folder', data:$data}" />
                
            <!-- /ko -->   
                                 
            <!-- ko if: type() == 'file' -->

                <li data-bind="template:{name:'template.file', data:$data}" />

            <!-- /ko -->
            
        </ul>

    </div>
}

@section content() {

    <pre id="editor"></pre>  

}   