@{ this.layout = '/views/layout.html' } 

@section scripts() {

    <script type="text/javascript" src="/public/static/script/jquery/jquery-1.10.1.min.js"></script>
    
    <script type="text/javascript" src="/public/static/script/knockoutjs/knockout-2.2.1.js"></script>

    <script type="text/javascript" src="/public/static/script/bootstrap/js/bootstrap-contextmenu.js"></script>

    <script type="text/javascript" src="/public/static/script/ace/ace.js"></script>

    <script type="text/javascript" src="/public/static/script/linq/linq.min.js"></script>
    
    <script type="text/javascript" src="/public/static/script/calcium/calcium.api.js"></script>
    
    <script type="text/javascript">
        
        var editor = null;

        var current_document = null;
        
        function PageModel()
        {
            this.tree = ko.observable( new FolderModel(null, '/') );

            this.tree().load();

            this.tree().on('data', function(data) {

                current_document = data;
                
                editor.setValue(data.content, -1);

            });
        }

        function resize() {

            $('#editor').height($(window).height() - 120);    
            
            editor.resize();
        }

        var isCtrl = false; 

        function register_events() 
        {
            document.onkeyup=function(e)
            { 
                if(e.which == 17) 
                {
                    isCtrl = false; 
                }
            } 
    
            document.onkeydown=function(e)
            { 
                if(e.which == 17) 
                {
                    isCtrl = true; 
                }
            
                if(e.which == 83 && isCtrl == true) 
                { 
                    calcium.api.post('/storage/' + current_document.path,  editor.getValue(), function(data) {
                    
                        // check the api because this isn't calling back.

                    });

                    return false; 
                } 
            }

            $(window).resize(resize); resize();
       }

        function initialize() 
        {    
            calcium.api.load('/public/views/editor/components/filetree/template.html', function(content) {
                
                $('#side-bar-container').html(content);

                ko.applyBindings( new PageModel() );

            });

            editor = ace.edit("editor");

            editor.setPrintMarginColumn(false);
            
            editor.setTheme("ace/theme/tomorrow_night");
            
            editor.getSession().setMode("ace/mode/typescript");

            register_events();
        }
        
        $(document).ready( initialize );


        
    </script>
}

@section sidebar() {


    <div id="side-bar-container"><!-- dynamic content here --> </div>

}

@section content() {

    <pre id="editor"></pre>  

}   